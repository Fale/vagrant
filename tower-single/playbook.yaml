---
- hosts: all
  name: Install Ansible Tower
  vars:
    version: '3.1.4'
  tasks:
    - name: Ensure EPEL is enabled
      yum:
        name: epel-release
        state: present
      become: True
    - name: Set hostname
      hostname:
        name: '{{ inventory_hostname }}' 
      become: True
    - get_url:
        url: 'http://releases.ansible.com/ansible-tower/setup/ansible-tower-setup-{{ version }}.tar.gz'
        dest: '/tmp/ansible-tower-setup-{{ version }}.tar.gz'
    - unarchive:
        remote_src: True
        src: '/tmp/ansible-tower-setup-{{ version }}.tar.gz'
        dest: /tmp
    - copy:
        remote_src: True
        dest: '/tmp/ansible-tower-setup-{{ version }}/inventory'
        src: /vagrant/inventory
    - shell: ./setup.sh
      args:
        chdir: '/tmp/ansible-tower-setup-{{ version }}'
      become: True
